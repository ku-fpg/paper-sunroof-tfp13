 
\section{Introduction}

% Simon: Describe the problem
JavaScript is an imperative language with access to a wide range
of established and useful services, like graphical canvases and event
handling. JavaScript as a language also provides features that are
traditionally associated with functional languages, like first-class 
functions. We want to express JavaScript in Haskell, adding use
of Haskell's static typing, and gaining access to JavaScript services
in the Browser in Haskell.

% Simon: State your contributions
Sunroofs was developed to tackle this goal. 
when generating JavaScript. Lets look at the small example
in figure \ref{fig:code-example} to see how it achieves this goal.

% Simon: An illustrative example
\begin{figure}[h]
\vspace{-0.5cm}
\centering
\begin{subfigure}{0.45\textwidth}%
\begin{verbatim}
 jsCode :: JS t ()
 jsCode = do
   name <- prompt "Your name?"
   alert ("Your name: " <> name)
\end{verbatim}%
\end{subfigure}%
\hfill%
\begin{subfigure}{0.45\textwidth}
\vspace{0.25cm}%
\begin{verbatim}
  
  
var v0 = prompt("Your name?"); 
alert("Your name: " + v0);
\end{verbatim}%
\end{subfigure}% 
%\vspace{-0.2cm}%
\caption{Sunroof program and the expected JavaScript on the left.}%
\label{fig:code-example}%
\vspace{-0.5cm}
\end{figure}

% Simon: Why is this useful?
We can see what code we expect the program to produce when 
translated to JavaScript on the right. But what makes 
this useful? The JavaScript we want to produce with the given
Haskell is shorter and can easily be written by hand.
% Simon: List of contributions
Sunroof's approach has several advantages. It introduces a 
threading model similar
to Haskell's. Like this programmers can reuse abstractions
well known from Haskell when writing JavaScript.
We also introduces types that support us when 
writing code and reveal common mistakes. The functions
in figure \ref{fig:code-example} have the following signatures:
\begin{verbatim}
prompt :: JSString -> JSString -> JS t JSObject
alert  :: JSString -> JS t ()
\end{verbatim}
This improves the quality of written code.
Using a deep embedding like this gives opportunity 
for optimizations when producing the actual JavaScript.
At the same time Sunroof offers an interface that is 
close to actual JavaScript making it easy to use.
We model the imperative nature of JavaScript
using the transitional functional programming 
mechanism for being imperative, a monad~\cite{Moggi:91:ComputationMonads}.
\TODO{Talk about foreign function interface}

% The scope of this paper is to show how Sunroof achieves these goals.
% It will cover the most important parts of Sunroof and how they are 
% implemented.
\Figure%
{fig:structure}%
{figures/sunroof-structure.pdf}%
{The structure of Sunroof.}
Figure \ref{fig:structure} displays Sunroof's structure. 
We will go over each of these layers in detail:
\begin{itemize}
\item
The \JS-monad together with the underlying \JSI~primitives 
will be explained in Section \ref{sec:js-monad}. 
We will show how it is implemented and how we solved
the problem of restricting the types involved in the monadic 
computations.
\item
Section \ref{sec:object-model} will discuss how we annotate 
the JavaScript objects in Sunroof with types using wrappers 
and offer the possibility 
to add custom types later on.
\item
The special role of functions and continuations will
be treated in Section \ref{sec:functions-continuations}. 
It covers how we model and handle
them as first-class values in Haskell and JavaScript.
\item
The implementation of the two threading models offered by Sunroof is explained 
in Section \ref{sec:threading-models}.
\item
How the translation of Sunroof to JavaScript works is handled in 
Section \ref{sec:compiler}. We will take a close look to the
different layers of abstractions and in detail explain the 
translation of selected language constructs. This is 
especially interesting in the light of our use of continuations, which
are directly translated into JavaScript.
\item
As Sunroof is quite useful in combination with a server \cite{Farmer:12:WebDSLs},
Section \ref{sec:server} will explain how we can utilize it 
to interleave Haskell and JavaScript computations as needed.
\item
Section \ref{sec:extended-example} will covers a small application 
written in Sunroof. It shows how Sunroof can be used to utilize the 
display capabilities of a browser, while still using Haskell when needed
and where it is strong.
\end{itemize}

\begin{comment}
\subsubsection{RESOURCES - REMOVE WHEN FINISHED}

\begin{itemize}
\item Give an example of Sunroof 
\item Explain the example
\item Talk about the general structure of Sunroof
\item Relate each part of the structure to a specific section:
  \begin{itemize}
  \item \JSA\ /\ \JSB: \JS-monad in section \ref{sec:js-monad};
  together with \JSI\ and contiuations used by the \JS-monad.
  \item Type Wrappers / Expr: Discussed in section \ref{sec:object-model}
  \end{itemize}
\item Details about functions and continuations are given in section \ref{sec:functions-continuations}
\item 
Sunroof was first documented in our previous 
workshop paper~\cite{Farmer:12:WebDSLs},
where the possibility of monadic reification was observed.
In this paper, we raised an unresolved issue:

Threading Model: Built on top of \JS-monad (section \ref{sec:threading-models})
\item Explain how the compiler works and what it does \ref{sec:compiler}
\item In section \ref{sec:server} we will look at the sunroof server 
\item Extended example in section \ref{sec:extended-example}

\end{itemize}

We want to use the Javascript API. Fast interpreters,
running in a browser advantage, 

We do not want to program in Javascript.

\end{comment}



 
\section{Introduction}

% Simon: Describe the problem
JavaScript is an imperative language with access to a wide range
of established and useful services like graphical canvases and event
handling. It also provides features that are associated with 
functional languages, such as first-class functions. 
We want to express JavaScript in Haskell, adding use
of Haskell's static typing, and gaining access to JavaScript services
in the browser from Haskell.

% Simon: State your contributions
Sunroof was developed to tackle the goal of generating JavaScript.
The small example in \FigRef{fig:code-example} 
shows how Sunroof feels.
% Simon: An illustrative example
\begin{figure}
%\vspace{-0.5cm}
\centering
\begin{subfigure}{0.45\textwidth}%
\begin{Code}
 jsCode :: JS t ()
 jsCode = do
   name <- prompt "Your name?"
   alert ("Your name: " <> name)
\end{Code}%
\end{subfigure}%
\hfill%
\begin{subfigure}{0.45\textwidth}
\vspace{0.25cm}%
\begin{Code}
  
  
var v0 = prompt("Your name?"); 
alert("Your name: " + v0);
\end{Code}%
\end{subfigure}% 
%\vspace{-0.2cm}%
\caption{Sunroof program and the expected JavaScript on the left.}%
\label{fig:code-example}%
\vspace{0.5cm}%
\end{figure}
% Simon: Why is this useful?
The expected JavaScript output is shown on the right. 
The JavaScript is shorter than the Sunroof code, raising
the question of why generate JavaScript from Haskell.

% Simon: List of contributions
Sunroof's approach has several advantages. 
It introduces a threading model and abstraction similar
to Haskell's. This allows programmers to use common Haskell 
techniques when writing JavaScript.
We also utilize the static type system to support us when 
writing code, e.g. the functions
in \FigRef{fig:code-example} have the following signatures:
\begin{Code}
prompt :: JSString -> JSString -> JS t JSObject
alert  :: JSString -> JS t ()
\end{Code}
This allows the type checker to detect a wide class
of malformed JavaScript programs.
Using a deep embedding gives opportunity 
for optimizations when producing the actual JavaScript.
At the same time, Sunroof offers an interface that is 
close to actual JavaScript making it easy to use.
The interface is easily extendable through
a foreign-function interface.
We use a monad \cite{Moggi:91:ComputationMonads} 
to reflect the imperative nature of JavaScript.

% The scope of this paper is to show how Sunroof achieves these goals.
% It will cover the most important parts of Sunroof and how they are 
% implemented.
\Figure%
{fig:structure}%
{figures/sunroof-structure.pdf}%
{The structure of Sunroof.}

\FigRef{fig:structure} shows Sunroof's structure.
We will cover each of the layers throughout the paper:
\begin{itemize}
\item
The semantics and implementation of the \JS-monad is explained 
in \SecRef{sec:js-monad}, along with a description of how
we solved
the problem of constraining types involved in the monadic 
computations.
\item
\SecRef{sec:object-model} will discuss how we annotate 
JavaScript objects with types using wrappers 
and offer the possibility to add custom types later on.
\item
The special role of functions, continuations and
how we model them as first-class values in Haskell and JavaScript
will be covered in \SecRef{sec:functions-continuations}.
\item
The two threading models offered by Sunroof are explained 
in \SecRef{sec:threading-models}.
\item
\SecRef{sec:ffi} introduces Sunroof's foreign-function interface.
\item
Translation of Sunroof to JavaScript is handled in 
\SecRef{sec:compiler}. We will explain the 
compilation of selected language constructs. This is 
especially interesting in the light of our use of continuations
and their translation to JavaScript.
\item
The ability to interleave Haskell and JavaScript computations as needed
through the Sunroof server will be highlighted in \SecRef{sec:server}.
\item
\SecRef{sec:extended-example} will cover a small application 
written in Sunroof to survey how usable Sunroof is in the 
context of application development. 
%It shows how Sunroof can be used to utilize the 
%display capabilities of a browser, while still using Haskell when needed
%and where it is strong.
\end{itemize}

\begin{comment}
\subsubsection{RESOURCES - REMOVE WHEN FINISHED}

\begin{itemize}
\item Give an example of Sunroof 
\item Explain the example
\item Talk about the general structure of Sunroof
\item Relate each part of the structure to a specific section:
  \begin{itemize}
  \item \JSA\ /\ \JSB: \JS-monad in \SecRef{sec:js-monad};
  together with \JSI\ and contiuations used by the \JS-monad.
  \item Type Wrappers / Expr: Discussed in \SecRef{sec:object-model}
  \end{itemize}
\item Details about functions and continuations are given in \SecRef{sec:functions-continuations}
\item 
Sunroof was first documented in our previous 
workshop paper~\cite{Farmer:12:WebDSLs},
where the possibility of monadic reification was observed.
In this paper, we raised an unresolved issue:

Threading Model: Built on top of \JS-monad (\SecRef{sec:threading-models})
\item Explain how the compiler works and what it does \SecRef{sec:compiler}
\item In \SecRef{sec:server} we will look at the sunroof server 
\item Extended example in \SecRef{sec:extended-example}

\end{itemize}

We want to use the Javascript API. Fast interpreters,
running in a browser advantage, 

We do not want to program in Javascript.

\end{comment}


